# 采摘通 · 分角色联调与测试清单

用于按不同主体（超级管理员、基地管理员、采摘工）调试前后端联通与功能正确性。

---

## 一、环境确认

| 服务       | 地址                     | 说明 |
|------------|--------------------------|------|
| 前端(React)| http://localhost:3000    | Vite 开发服务器，`/api` 代理到后端 |
| 后端(Nest) | http://localhost:3001/api| 全局前缀 `api`，Swagger: http://localhost:3001/docs |
| MySQL      | localhost:3306           | 数据库 `pickpass_db` |

**前后端联通**：前端请求 `/api/xxx` 会由 Vite 代理到 `http://localhost:3001/api/xxx`，无需跨域；`http.ts` 中 `baseURL: 'http://localhost:3001'`，Orval 生成的请求会带 Token 访问后端。

---

## 二、测试账号（手机号 + 身份证后6位）

以下账号需与数据库 `sys_user` 及导入的 SQL 数据一致；若本地无对应数据，请先用 Swagger 或 SQL 插入/核对。

| 角色           | 姓名           | 手机号        | 密码(身份证后6位) | 说明 |
|----------------|----------------|---------------|-------------------|------|
| 超级管理员     | 系统总管理员李 | 13811138000   | 011234            | 可进「基地管理」审核、全部菜单 |
| 基地管理员     | 王经理         | （见数据库）  | （见数据库）      | 可进基地相关、招聘、考勤、薪资 |
| 采摘工         | 李四           | （见数据库）  | （见数据库）      | 登录后跳转「采摘工工作台」 |

更多示例见项目根目录 `app/infomation.txt`（含登录响应示例）。

---

## 三、分角色联调步骤

### 1. 超级管理员（super_admin）

1. **登录**
   - 打开 http://localhost:3000/login
   - 手机号：`13811138000`，密码：`011234`（身份证后6位）
   - 预期：跳转到 `/dashboard`，侧栏有「概览、基地管理、招聘管理、考勤管理、薪资结算、人员管理」

2. **前后端联通**
   - 登录后打开 http://localhost:3000/dashboard/bases
   - 预期：基地列表由后端 `GET /api/base` 返回；若数据库无基地则显示「暂无基地数据」；若有数据则展示列表（含加载中/错误态）

3. **基地管理**
   - 「基地管理」页可切换「全部基地」/「审核中」；列表展示基地名称、类别、状态、区域、联系方式等
   - 审核功能：待审核基地可在列表中操作；具体审核接口为 `PATCH /api/base/:id/audit`（可用 Swagger 验证）

4. **其他菜单**
   - 招聘管理、考勤管理、薪资结算、人员管理：当前为占位页，可按 `测试指南.md` 用 Swagger 逐接口验证

### 2. 基地管理员（base_manager）

1. 使用基地管理员账号登录（手机号/身份证后6位以数据库为准）
2. 预期：跳转 `/dashboard`，可见基地相关、招聘、考勤、薪资等菜单（按路由权限）
3. 在「基地管理」中应能看到与本人基地相关的数据（若后端按 `ownerId` 过滤）
4. 招聘/考勤/薪资：页面为占位时，用 Swagger 验证 `POST /api/base/:id/jobs`、考勤与薪资相关接口

### 3. 采摘工（worker）

1. 使用采摘工账号登录（如李四，账号见数据库或 `infomation.txt`）
2. 预期：跳转 `/worker`（采摘工工作台），不进入管理后台
3. 页面展示欢迎语及退出按钮；更多工人端功能在小程序侧完成

---

## 四、功能自检清单（前后端是否联通）

| 功能           | 前端入口              | 后端接口               | 自检方法 |
|----------------|-----------------------|------------------------|----------|
| 登录           | /login                | POST /api/auth/login   | 输入账号密码，能跳转且侧栏/工作台正常 |
| 基地列表       | /dashboard/bases      | GET /api/base          | 列表数据来自接口，无 CORS/401 |
| 基地详情       | （可扩展）            | GET /api/base/:id      | Swagger 或前端点击详情 |
| 基地审核       | 基地管理-审核中       | PATCH /api/base/:id/audit | Swagger 或前端按钮 |
| 招聘/考勤/薪资 | /dashboard/jobs 等    | 见 测试指南.md         | 当前为占位，用 Swagger 验证接口 |

---

## 五、常见问题

- **登录后白屏或角色不对**：检查后端返回的 `user.role` / `user.roleKey`；前端已兼容两者。
- **基地列表一直加载/报错**：确认后端已启动（http://localhost:3001/docs 可访问）、数据库已导入且 `pickpass_db` 有数据。
- **401 Unauthorized**：登录后请求需带 `Authorization: Bearer <token>`；前端 `http.ts` 已从 localStorage 取 token 并注入，确认已登录且未过期。

按上述步骤可系统性验证「不同主体登录 → 前后端联通 → 各功能是否正确」。
