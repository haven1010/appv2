<!--pages/field/scan/scan.wxml-->
<view class="page">
  <!-- å¤´éƒ¨ä¿¡æ¯ -->
  <view class="scan-header">
    <text class="scan-title">æ‰«ç ç­¾åˆ°</text>
    <text class="scan-base" wx:if="{{baseName}}">å½“å‰åŸºåœ°ï¼š{{baseName}}</text>
    <text class="scan-base warn" wx:elif="{{!baseId}}">æœªç»‘å®šåŸºåœ°</text>
  </view>

  <!-- ç­¾åˆ°ç»“æœå±•ç¤º -->
  <view class="result-card {{scanResult.success ? 'success' : 'fail'}}" wx:if="{{scanResult}}">
    <view class="result-icon">{{scanResult.success ? 'âœ“' : 'âœ—'}}</view>
    <view class="result-name" wx:if="{{scanResult.name}}">{{scanResult.name}}</view>
    <view class="result-msg">{{scanResult.message}}</view>
    <view class="result-time" wx:if="{{scanResult.time}}">{{scanResult.time}}</view>
    <view class="btn-clear" bindtap="clearResult">ç¡®å®š</view>
  </view>

  <!-- æ‰«ç åŒºåŸŸ -->
  <view class="scan-area" wx:if="{{!scanResult}}">
    <view class="scan-visual">
      <view class="scan-frame">
        <view class="corner tl"></view>
        <view class="corner tr"></view>
        <view class="corner bl"></view>
        <view class="corner br"></view>
        <view class="scan-line" wx:if="{{scanning}}"></view>
      </view>
      <text class="scan-hint">{{scanning ? 'æ‰«æä¸­...' : 'ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®å¼€å§‹æ‰«ç '}}</text>
    </view>

    <button class="btn-scan" bindtap="startScan" disabled="{{loading || scanning}}">
      <text class="btn-scan-icon">ğŸ“·</text>
      <text class="btn-scan-text">{{loading ? 'å¤„ç†ä¸­...' : 'æ‰“å¼€æ‘„åƒå¤´æ‰«ç '}}</text>
    </button>

    <!-- æ‰‹åŠ¨è¾“å…¥åŒºåŸŸ -->
    <view class="manual-section">
      <view class="manual-title">æˆ–æ‰‹åŠ¨è¾“å…¥äºŒç»´ç å†…å®¹</view>
      <view class="manual-row">
        <input
          class="manual-input"
          placeholder="ç²˜è´´äºŒç»´ç å†…å®¹"
          value="{{manualInput}}"
          bindinput="onManualInput"
        />
        <view class="btn-manual" bindtap="submitManual">ç­¾åˆ°</view>
      </view>
    </view>
  </view>

  <!-- æœ¬æ¬¡æ‰«ç å†å² -->
  <view class="history-section" wx:if="{{history.length > 0}}">
    <view class="section-title">æœ¬æ¬¡æ‰«ç è®°å½• ({{history.length}})</view>
    <view class="history-list">
      <view class="history-item {{item.success ? 'success' : 'fail'}}" wx:for="{{history}}" wx:key="index">
        <view class="history-status">{{item.success ? 'âœ“' : 'âœ—'}}</view>
        <view class="history-info">
          <text class="history-name">{{item.name || 'æœªçŸ¥'}}</text>
          <text class="history-msg">{{item.message}}</text>
        </view>
        <text class="history-time">{{item.time}}</text>
      </view>
    </view>
  </view>
</view>
