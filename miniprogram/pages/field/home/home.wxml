<!--pages/field/home/home.wxml-->
<view class="page">
  <!-- å¤´éƒ¨ -->
  <view class="header">
    <view class="logo-row">
      <view class="logo">F</view>
      <text class="title">ç°åœºç®¡ç†å·¥ä½œå°</text>
    </view>
    <view class="welcome" wx:if="{{userInfo}}">
      <text class="welcome-text">ä½ å¥½ï¼Œ{{userInfo.name}}</text>
    </view>
  </view>

  <!-- åŠ è½½ä¸­ -->
  <view class="loading-box" wx:if="{{loading}}">
    <text>åŠ è½½ä¸­...</text>
  </view>

  <!-- é”™è¯¯æç¤º -->
  <view class="error-card" wx:elif="{{error}}">
    <text class="error-icon">âš </text>
    <text class="error-msg">{{error}}</text>
    <view class="btn-retry" bindtap="loadData">é‡è¯•</view>
  </view>

  <block wx:else>
    <!-- åŸºåœ°ä¿¡æ¯å¡ç‰‡ -->
    <view class="base-card" wx:if="{{baseInfo}}">
      <view class="base-card-header">
        <view class="base-badge">ç®¡è¾–åŸºåœ°</view>
      </view>
      <view class="base-name">{{baseInfo.name || 'åŸºåœ° #' + baseId}}</view>
      <view class="base-detail-row">
        <text class="base-detail-label">åœ°å€</text>
        <text class="base-detail-val">{{baseInfo.address || '-'}}</text>
      </view>
      <view class="base-detail-row">
        <text class="base-detail-label">ç±»å‹</text>
        <text class="base-detail-val">{{baseInfo.category || '-'}}</text>
      </view>
      <view class="base-detail-row">
        <text class="base-detail-label">è”ç³»äºº</text>
        <text class="base-detail-val">{{baseInfo.contactPerson || '-'}} {{baseInfo.contactPhone || ''}}</text>
      </view>
    </view>

    <!-- ä»Šæ—¥è€ƒå‹¤ç»Ÿè®¡ -->
    <view class="stats-card">
      <view class="section-title-row">
        <text class="section-title">ä»Šæ—¥è€ƒå‹¤</text>
      </view>
      <view class="stats-grid">
        <view class="stat-item">
          <text class="stat-value green">{{stats.checkedIn}}</text>
          <text class="stat-label">å·²ç­¾åˆ°</text>
        </view>
        <view class="stat-item border-mid">
          <text class="stat-value orange">{{stats.pending}}</text>
          <text class="stat-label">å¾…ç­¾åˆ°</text>
        </view>
        <view class="stat-item border-mid">
          <text class="stat-value red">{{stats.absent}}</text>
          <text class="stat-label">ç¼ºå‹¤</text>
        </view>
        <view class="stat-item">
          <text class="stat-value">{{stats.rate}}</text>
          <text class="stat-label">ç­¾åˆ°ç‡</text>
        </view>
      </view>
    </view>

    <!-- å¿«æ·æ“ä½œ -->
    <view class="actions">
      <view class="action-btn scan-btn" bindtap="goScan">
        <text class="action-icon">ğŸ“·</text>
        <text class="action-text">æ‰«ç ç­¾åˆ°</text>
        <text class="action-desc">æ‰«æå·¥äººäºŒç»´ç å®Œæˆç­¾åˆ°</text>
      </view>
      <view class="action-btn records-btn" bindtap="goRecords">
        <text class="action-icon">ğŸ“‹</text>
        <text class="action-text">è€ƒå‹¤è®°å½•</text>
        <text class="action-desc">æŸ¥çœ‹ä»Šæ—¥ç­¾åˆ°æ˜ç»†</text>
      </view>
    </view>

    <!-- æœ€è¿‘ç­¾åˆ°è®°å½• -->
    <view class="recent-section" wx:if="{{recentRecords.length > 0}}">
      <view class="section-title-row">
        <text class="section-title">æœ€è¿‘ç­¾åˆ°</text>
        <text class="section-link" bindtap="goRecords">æŸ¥çœ‹å…¨éƒ¨ â€º</text>
      </view>
      <view class="record-list">
        <view class="record-item" wx:for="{{recentRecords}}" wx:key="id">
          <view class="record-avatar">{{item.user ? item.user.name[0] : '?'}}</view>
          <view class="record-info">
            <text class="record-name">{{item.user ? item.user.name : item.userName || 'æœªçŸ¥'}}</text>
            <text class="record-time">{{item.checkinTime || item.createdAt || '-'}}</text>
          </view>
          <view class="record-status success">å·²ç­¾åˆ°</view>
        </view>
      </view>
    </view>

    <!-- æ— æ•°æ®æ—¶ -->
    <view class="empty-box" wx:if="{{!loading && !baseInfo && !error}}">
      <text>æš‚æ— åŸºåœ°ä¿¡æ¯</text>
    </view>
  </block>
</view>
